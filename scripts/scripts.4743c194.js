(function(){"use strict";angular.module("sc2App",["LocalStorageModule","ngSanitize","ngAnimate"])}).call(this),function(){"use strict";angular.module("sc2App").service("UserService",["localStorageService","$rootScope",function(a,b){return self.userObj=a.get("userObj"),self.setUser=function(c){return a.set("userObj",c),self.userObj=c,b.$broadcast("userStateChanged")},self.logout=function(){return a.remove("userObj")},self}])}.call(this),function(){"use strict";angular.module("sc2App").factory("audioContext",function(){var a,b,c,d,e,f,g,h;return window.AudioContext=window.AudioContext||window.webkitAudioContext,a=new window.AudioContext,f=document.createElement("audio"),f.crossOrigin="anonymous",g=document.createElement("audio"),b=a.createAnalyser(),b.smoothingTimeConstant=.6,b.fftSize=256,e=a.createAnalyser(),e.smoothingTimeConstant=.3,e.fftSize=2048,d=a.createGain(),h=a.createMediaElementSource(f),h.connect(d),d.connect(e),d.connect(b),d.connect(a.destination),c={player:f,playerNoVis:g,analyser:b,osc:e,gain:d.gain}})}.call(this),function(){"use strict";angular.module("sc2App").service("CanvasService",function(){var a,b,c,d,e,f,g;a=document.createElement("canvas"),a.width=450,a.height=100,b=document.createElement("canvas"),b.width=450,b.height=100,d=document.createElement("canvas"),d.width=450,d.height=100,f=document.createElement("canvas"),f.width=450,f.height=100,g=document.createElement("canvas"),g.width=450,g.height=100,e=document.createElement("canvas"),e.width=450,e.height=100,c={analyserBottomContext:a.getContext("2d"),analyserTopContext:b.getContext("2d"),oscContext:d.getContext("2d"),waveformContext:f.getContext("2d"),waveformProgressContext:g.getContext("2d"),waveformBufferContext:e.getContext("2d")},this.canvases=function(){return c},this.drawWaveform=function(a,b,c){var d,e,f,g;for(b.fillStyle=c,b.clearRect(0,0,b.canvas.width,100),e=Math.floor(b.canvas.width/6),f=Math.floor(1800/e),g=void 0,b.strokeStyle=c,b.lineCap="round",b.lineWidth=4,b.beginPath(),d=0;e>d;)g=a?(.7*a[d*f]).toFixed():1,b.moveTo(6*d+2,50-.5*g),b.lineTo(6*d+2,50+.5*g),d++;return b.stroke()},this.drawAnalyzerBgr=function(a,b,c,d,e){var f,g;for(f=void 0,g=void 0,a.strokeStyle="rgba(255,255,255,0.07)",a.lineCap="round",a.lineWidth=4,a.beginPath(),f=0;b>f;){for(g=0;20>g;)a.moveTo(f*c+2,104-6*g),a.lineTo(f*c-2+e,104-6*g),++g;++f}return a.stroke()},this.drawWaveform(null,c.waveformContext,"rgba(255,255,255,0.2)"),this.drawAnalyzerBgr(c.analyserBottomContext,15,30,100,28)})}.call(this),function(){"use strict";angular.module("sc2App").factory("AdditiveBlendShader",["$window",function(a){var b;return b={uniforms:{tBase:{type:"t",value:null},tAdd:{type:"t",value:null},amount:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tBase;","uniform sampler2D tAdd;","uniform float amount;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tBase, vUv );","vec4 texel2 = texture2D( tAdd, vUv );","gl_FragColor = texel1 + texel2 * amount;","}"].join("\n")}}])}.call(this),function(){"use strict";angular.module("sc2App").service("SoundCloudService",["$window","$http","$q","soundcloudConfig","UserService","streamUrlServiceUrl",function(a,b,c,d,e,f){this.connect=function(){var f,g,h;return g=c.defer(),f=a.SC,h={},f.initialize({client_id:d.apiKey,redirect_uri:d.redirectUri,scope:"non-expiring"}),f.connect(function(){return h.token=f.accessToken(),b.get(d.apiBaseUrl+"/me",{params:{oauth_token:h.token}}).success(function(a){return h.user=a,g.resolve(h),e.setUser(h)})}),g.promise},this.getPlaylistTracks=function(a){var f,g,h,i;for(i=[],f=0,g=a.length;g>f;f++)h=a[f],i.push(b.get(d.apiBaseUrl+"/playlists/"+h+"/tracks",{params:{oauth_token:e.userObj.token}}));return c.all(i)},this.res=function(a,c,f,g){return g.oauth_token=e.userObj.token,b({method:c,url:d.apiBaseUrl+"/me/"+a+f,params:g})},this.checkHeaders=function(a){return b.jsonp(f+"&stream="+a+"?client_id="+d.apiKey).then(function(a){var b;return b={vis:angular.isArray(a.data["access-control-allow-origin"]),url:a.data.location}})},this.getWaveformData=function(a){return b.get(a)},this.downloadUrl=function(a){return d.apiBaseUrl+"/tracks/"+a+"/download?client_id="+d.apiKey}}])}.call(this),function(){"use strict";angular.module("sc2App").service("ContentService",["$q","$window","SoundCloudService","HelperService","UserService","localStorageService",function(a,b,c,d,e,f){var g,h,i,j,k,l;i=b.moment,l=void 0,h=50,k=0,this.lastFetch=g=f.get("lastFetch"),j=i().format("YYYY-MM-DD HH:mm:ss"),this.loadContent=function(){var b,m,n,o,p,q;return b={playlists:{ids:[],items:[]},favorites:[],followings:{},stream:[],likeIds:[]},o=function(a,e,f){var h;return h=[],Number.isInteger(f)?(a.origin=a,h=f>=0?[f,e]:[e]):h=[e],{index:h,isNew:i(a.created_at,"YYYY/MM/DD HH:mm:ss ZZ").isAfter(i(g)),scDate:a.created_at,created:d.customDate(a.created_at,"MMMM DD YYYY"),type:a.type||a.kind,repost:a.type?a.type.indexOf("repost")>-1:!1,title:a.origin.title,scid:a.origin.id,duration:a.origin.duration,durationFormatted:d.duration(a.origin.duration),stream:a.origin.stream_url,streamable:a.origin.streamable,waveform:a.origin.waveform_url,artwork:a.origin.artwork_url,buy:a.origin.purchase_url,downloadlink:a.origin.downloadable?c.downloadUrl(a.origin.id):!1,link:a.origin.permalink_url,username:a.origin.user.username,userlink:a.origin.user.permalink_url,avatar:a.origin.user.avatar_url,favoriteFlag:b.likeIds.indexOf(a.origin.id)>-1,followingFlag:b.followings.hasOwnProperty(a.origin.user_id),description:a.origin.description?d.description(a.origin.description):!1,favList:0>f}},p=function(b,d){var e,f,g,i,j,k,l;for(e=a.defer(),j=[],l=[],f=function(d){var e;return e=a.defer(),c.res(b,"get","",{limit:h,offset:d}).then(function(a){return e.resolve(a.data)}),e.promise},g=i=0,k=Math.ceil(d/h);k>=0?k>i:i>k;g=k>=0?++i:--i)j.push(f(g*h));return a.all(j).then(function(a){var b,c,d,f,g,h;for(c=0,f=a.length;f>c;c++)for(h=a[c],d=0,g=h.length;g>d;d++)b=h[d],l.push(b);return e.resolve(l)}),e.promise},angular.equals(b.followings,{})&&(n=p("followings",e.userObj.user.followings_count).then(function(a){var c,e,f,g;for(f=[],c=0,e=a.length;e>c;c++)g=a[c],g.description&&(g.description=d.description(g.description)),g.followingFlag=!0,f.push(b.followings[g.id]=g);return f}),m=p("favorites",e.userObj.user.public_favorites_count).then(function(a){var c,d,e,f,g;for(g=[],f=c=0,d=a.length;d>c;f=++c)e=a[f],b.likeIds.push(e.id),b.favorites.push(o(e,f,-1)),g.push(b.favorites[f].favoriteFlag=!0);return g})),q=c.res("activities/tracks/affiliated","get","",{limit:h,cursor:l}),a.all([n,m,q]).then(function(a){var d,e,g,i,m,n;for(i=a[2],l=i.data.next_href.split("cursor=")[1],b.stream=[],g=i.data.collection,n=d=0,e=g.length;e>d;n=++d)m=g[n],m=o(m,n+k*h,!1),b.stream.push(m),("playlist"===m.type||"playlist-repost"===m.type)&&b.playlists.ids.push(m.scid);return c.getPlaylistTracks(b.playlists.ids).then(function(a){var c,d,e,f,g,h,i,j,k,l,n,p;for(d=0,f=a.length;f>d;d++)j=a[d],b.playlists.items.push(j);for(n=b.stream,e=0,g=n.length;g>e;e++)if(m=n[e],c=b.playlists.ids.indexOf(m.scid),c>-1)for(m.tracks=[],p=b.playlists.items[c].data,l=i=0,h=p.length;h>i;l=++i)k=p[l],k=o(k,l,m.index[0]),m.tracks.push(k);return b.stream[b.stream.length-1].last=!0}),k++,f.set("lastFetch",j),b})}}])}.call(this),function(){"use strict";angular.module("sc2App").service("HelperService",["$window",function(a){var b,c,d;b=a.moment,c="YYYY/MM/DD HH:mm:ss ZZ",d=/((("|>)?\b(https?):\/\/|www)[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,this.duration=function(a){var c,d,e;return c=b.duration(a).get("hours"),d=b.duration(a).get("minutes"),e=b.duration(a).get("seconds"),1>e/10&&(e="0"+e),0!==c?(1>d/10&&(d="0"+d),c+":"+d+":"+e):d+":"+e},this.customDate=function(a,d){return"ago"===d?b(a).fromNow():b(a,c).format(d)},this.description=function(a){var b;return b=a.replace(d,function(a){return a.indexOf('"')>-1||a.indexOf(">")>-1?a:(0===a.indexOf("www")&&(a="http://"+a),'<a target="_blank" href="'+a+'">'+a+"</a>")}),b.replace(/\n/g,"<br>")}}])}.call(this),function(){"use strict";angular.module("sc2App").factory("animation",["$window","audioContext","CanvasService","AdditiveBlendShader",function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;return w=this,x=30,h=28,q=15,p=void 0,t=void 0,m=void 0,i=void 0,e=a.THREE,j=void 0,v=void 0,z=void 0,u=void 0,l=void 0,n=void 0,y=void 0,s=void 0,w.requestId=null,f=new Uint8Array(b.analyser.frequencyBinCount),r=new Uint8Array(b.osc.frequencyBinCount),k=c.canvases(),k.oscContext.lineWidth=3,k.oscContext.strokeStyle="#ffffff",k.analyserTopContext.strokeStyle="#ffffff",k.analyserTopContext.lineCap="round",k.analyserTopContext.lineWidth=4,w.x3dscope=!1,w.animate=function(){return w.requestId=a.requestAnimationFrame(w.animate),w.x3dscope===!0?A():g()},w.killAnimation=function(){return w.requestId?(a.cancelAnimationFrame(w.requestId),w.requestId=void 0):void 0},o=function(){var a,b,c,f,g,h,k,o,p,q,r,w,x;for(x=800,w=600,f=document.getElementById("webGLWrapper"),j=new e.PerspectiveCamera(1,x/w,1,1e6),j.position.z=3e4,v=new e.Scene,h=new e.LineBasicMaterial({color:65535}),o=new e.Geometry,k=0;1024>k;)o.vertices.push(new e.Vector3(1*k,0,0)),k++;return s=new e.Line(o,h),v.add(s),s.position.x=-512,s.position.y=-100,v.add(new e.AmbientLight(16777215)),z=new e.WebGLRenderer,z.setSize(1920,955),f.appendChild(z.domElement),c=3,r={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBufer:!1},p=new e.WebGLRenderTarget(x,w,r),t=new e.EffectComposer(z,p),u=new e.RenderPass(v,j),g=new e.ShaderPass(e.CopyShader),b=new e.BloomPass(3,8,2,512),t.addPass(u),t.addPass(g),t.addPass(b),n=new e.ShaderPass(e.HorizontalBlurShader),y=new e.ShaderPass(e.VerticalBlurShader),n.uniforms.h.value=c/x,y.uniforms.v.value=c/w,g=new e.ShaderPass(e.CopyShader),q=new e.WebGLRenderTarget(x/4,w/4,r),m=new e.EffectComposer(z,q),m.addPass(g),m.addPass(u),m.addPass(b),m.addPass(n),m.addPass(y),m.addPass(n),m.addPass(y),i=new e.EffectComposer(z),a=new e.ShaderPass(d),a.uniforms.tBase.value=t.renderTarget1,a.uniforms.tAdd.value=m.renderTarget1,a.uniforms.amount.value=0,i.addPass(a),l=new e.ShaderPass(e.FilmShader),l.uniforms.grayscale.value=0,l.uniforms.sIntensity.value=.8,l.uniforms.sCount.value=w,i.addPass(l),l.renderToScreen=!0},o(),A=function(){var a;for(b.osc.getByteTimeDomainData(r),a=0;1024>a;)s.geometry.vertices[a].y=r[a],a++;return s.geometry.verticesNeedUpdate=!0,t.render(.1),m.render(.1),i.render(.1)},g=function(){var a,c;for(k.analyserTopContext.clearRect(0,0,450,100),b.analyser.getByteFrequencyData(f),k.analyserTopContext.beginPath(),a=0;q>a;){for(p=(f[3+8*a]/2.56).toFixed(),c=0;p/6>c;)k.analyserTopContext.moveTo(a*x+2,104-6*c),k.analyserTopContext.lineTo(a*x-2+h,104-6*c),++c;++a}for(k.analyserTopContext.stroke(),k.oscContext.clearRect(0,0,k.oscContext.canvas.width,100),b.osc.getByteTimeDomainData(r),k.oscContext.beginPath(),a=0;a<k.oscContext.canvas.width/2;)k.oscContext.lineTo(2*a,r[a]/2.56),a++;return k.oscContext.stroke()},w}])}.call(this),function(){"use strict";angular.module("sc2App").directive("player",["audioContext","HelperService","CanvasService","SoundCloudService","animation",function(a,b,c,d,e){return{restrict:"A",link:function(f,g,h){var i,j,k,l,m,n,o,p,q;return p=a.player,f.playerData={},f.fsScope=!1,m=function(){return f.$apply(function(){return f.playerData.currentTime=p.currentTime,f.playerData.currentTimeFormatted=b.duration(1e3*p.currentTime),p.currentTime===p.duration?(f.playerData.playingIndex=null,f.playerData.currentTrack.isPlaying=!1,f.playerData.currentTime=0,f.playerData.currentTrack=!1,e.killAnimation()):void 0})},i=function(){return f.$apply(function(){return f.playerData.duration=p.duration,f.playerData.seeking=!1})},l=function(){return f.$apply(function(){return f.playerData.seeking=!0})},k=function(){return f.$apply(function(){return f.playerData.seeking=!1})},j=function(){var a,b,c,d,e;for(d=[],e=p.buffered,a=0,b=e.length;b>a;a++)c=e[a],d.push([p.buffered.start(c),p.buffered.end(c)]);return d.length?f.$apply(function(){return f.playerData.buffered=d[d.length-1][1]}):void 0},q=function(){return p.addEventListener("timeupdate",m,!1),p.addEventListener("canplay",i,!1),p.addEventListener("seeking",l,!1),p.addEventListener("seeked",k,!1),p.addEventListener("progress",j,!1)},o=function(){return p.play(),e.requestId?void 0:e.animate()},n=function(){return p.pause(),e.killAnimation()},f.$on("playTrack",function(b,e){return e.replay?o():(e.previous&&(n(),e.previous.isPlaying=!1),d.checkHeaders(e.current.stream).then(function(b){return b.vis?(p=a.player,f.status.access=!1):(p=a.playerNoVis,f.status.access="Limited access to track, visualizers disabled"),q(),f.playerData.currentTrack=e.current,f.playerData.vis=b.vis,p.src=b.url,o()}),d.getWaveformData(e.current.waveform).then(function(a){return c.drawWaveform(a.data.samples,c.canvases().waveformContext,"rgba(255,255,255,0.05)"),c.drawWaveform(a.data.samples,c.canvases().waveformBufferContext,"rgba(255,255,255,0.15)"),c.drawWaveform(a.data.samples,c.canvases().waveformProgressContext,"#ffffff")}))}),f.$on("pauseTrack",function(){return n()}),f.$on("seekTrack",function(a,b){return p.currentTime=(b*p.duration).toFixed()}),f.$on("seekPreview",function(a,c){return f.seekCursor={xpos:c.xpos,time:b.duration(c.xpos*p.duration*1e3/c.width)}}),f.helpers={setVolume:function(b){return a.gain.value=b*b/1e4},toggleOsc:function(a){return!f.status.access&&f.playerData.playingIndex&&a?f.fsScope=e.x3dscope=!0:f.fsScope=e.x3dscope=!1}}}}}])}.call(this),function(){"use strict";angular.module("sc2App").directive("canvasContext",["CanvasService",function(a){return{restrict:"A",link:function(b,c,d){return c.append(a.canvases()[d.canvasContext].canvas)}}}])}.call(this),function(){"use strict";angular.module("sc2App").directive("theme",["localStorageService",function(a){return{restrict:"A",link:function(b){return b.theme=a.get("theme")||{bgr:"default",color:"light"},b.toggleThemeChanger=function(){return b.themeChanger=!b.themeChanger},b.changeTheme=function(c,d){return d?b.theme.color=c:b.theme.bgr=c,a.set("theme",b.theme)}}}}])}.call(this),function(){"use strict";angular.module("sc2App").directive("repeatFinished",["$timeout",function(a){return{restrict:"A",link:function(b){return b.$last===!0?a(function(){return b.$emit("ngRepeatFinished")}):void 0}}}])}.call(this),function(){"use strict";angular.module("sc2App").controller("pageCtrl",["$scope","$window","UserService","SoundCloudService","ContentService","localStorageService","HelperService",function(a,b,c,d,e,f,g){return a.user=c.userObj,a.$on("userStateChanged",function(){return a.user=c.userObj}),a.connect=function(){return d.connect().then(function(b){return a.$broadcast("connected")})},a.logout=function(){return c.logout(),b.location.reload()},f.bind(a,"settings.showReposts"),a.controls={toggleReposts:function(){return a.settings.showReposts=!a.settings.showReposts}},a.setTab=function(b){return a.activeTab=b},a.getTimes=function(a){return new Array(a)},a.setTab("stream")}])}.call(this),function(){"use strict";angular.module("sc2App").controller("streamCtrl",["$scope","$document","SoundCloudService","$filter","ContentService","UserService",function(a,b,c,d,e,f){var g,h,i,j;return a.status={loading:!1,error:!1},a.content={stream:[]},g=void 0,j=void 0,i=void 0,h=function(b){var c;return c=void 0,c=isNaN(b[1])?a.content[a.activeTab][b[0]]:a.content[a.activeTab][b[0]].tracks[b[1]]},a.$on("connected",function(){return a.loadData()}),a.loadData=function(){return a.status.loading=!0,e.loadContent().then(function(b){return a.content.stream.push.apply(a.content.stream,b.stream),a.content.followings=b.followings,a.content.favorites=b.favorites,a.helpers.getNewCount()})},a.$on("ngRepeatFinished",function(){return a.status.loading=!1}),a.like=function(a,b){var d,e;return d=h(b),e=d.scid,c.res("favorites/",a,e,{}).then(function(b){return 201===b.status?d.favoriteFlag=!0:200===b.status&&"delete"===a?d.favoriteFlag=!1:void 0})},a.follow=function(b,d){var e;return e=a.followings[d].id,c.res("followings/",b,e,{}).then(function(c){return 201===c.status?a.followings[d].followingFlag=!0:200===c.status&&"delete"===b?a.followings[d].followingFlag=!1:void 0})},a.controlAudio={play:function(b){var c;return c=angular.equals(i,b),i=b,g=h(b),g.isPlaying=!0,a.$broadcast("playTrack",{current:g,previous:j,replay:c}),j=g},pause:function(){return g.isPlaying=!1,a.$broadcast("pauseTrack")},seekTo:function(b){var c;return c=(void 0===b.offsetX?b.layerX:b.offsetX)/b.target.offsetWidth,a.$broadcast("seekTrack",c)},seekPreview:function(b){var c;return c=void 0===b.offsetX?b.layerX:b.offsetX,a.$broadcast("seekPreview",{xpos:c,width:b.target.clientWidth})}},a.helpers={getNewCount:function(){var c;return c=d("filter")(a.content.stream,{isNew:!0}),a.showReposts||(c=d("filter")(c,{repost:!1})),a.newCount=c.length,c.length>0?b[0].title="("+c.length+") sc2":b[0].title="sc2"}},f.userObj?a.loadData():void 0}])}.call(this);